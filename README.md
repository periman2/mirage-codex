# MirageCodex

The Infinite AI-Generated Library of Hallucinatory Literature

MirageCodex is an AI-powered "infinite library" that conjures entirely fictional books on-demand. Users can explore the library in two complementary modes: browsing existing generated books or searching to create new ones.

## ‚ú® Features

### üîç Browse Mode (Free)
- Wander shelves of books previously generated by anyone
- Filter by language, dynamic genres, and whimsical tags
- Hit the üé≤ Randomize button to discover unexpected tomes
- Beautiful book grid with generated covers and metadata

### üéØ Search Mode (Paid or BYO API Key)
- Enter free-text queries and choose genre + tags to *summon* new books
- Deterministic caching: same search parameters always return the same books
- Each generated book includes title, cover, outline, and lazily created pages
- Fictitious authors with stylized biographies
- Credit-based billing or bring-your-own AI API keys

### üìö Core Promise
**"Explore an endless, hallucinatory canon of literature‚Äîknowing it's all AI-spun fiction."**

## üõ† Tech Stack

### Frontend
- **Next.js 15** with App Router & TypeScript
- **Tailwind CSS** + **shadcn/ui** components
- **Vercel AI SDK** with `generateObject` for structured generation
- Responsive design with beautiful gradients and animations

### Backend
- **Supabase** (Postgres + Auth + Storage + Real-time)
- **Stripe** integration for credit purchases
- **Row-Level Security** (RLS) everywhere
- All business logic in Next.js API Route Handlers

### AI Integration
- Support for **OpenAI**, **Anthropic**, and **Google** models
- Structured generation using Zod schemas
- User API key support (BYO key) or credit-based usage
- Deterministic hashing for consistent results

## üìê Database Schema

### Reference Tables
- `languages` - Supported languages (en, el, es, fr)
- `model_domains` & `models` - AI model configurations
- `tag_categories`, `genres`, `tags` - Content taxonomy
- `genre_tags` - Many-to-many genre/tag relationships

### User Management
- `profiles` - User profiles (auto-created via trigger)
- `user_api_keys` - Encrypted BYO API keys (service-role only)
- `user_billing` - Credit balances and billing events

### Search & Content
- `searches` - Search records with deterministic hashes
- `search_params` - Search parameters and tags
- `books` & `authors` - Generated content
- `search_books` - Links searches to generated books
- `editions` & `book_pages` - Multi-language, lazy page generation
- `bookmarks` - User bookmarks and notes

## üöÄ Getting Started

### Prerequisites
- Node.js 18+ and npm
- Supabase project
- AI API keys (OpenAI, Anthropic, or Google)

### 1. Clone and Install
```bash
git clone <repository-url>
cd mirage-codex
npm install
```

### 2. Environment Setup
Copy `.env.example` to `.env.local` and configure:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# AI Model API Keys
OPENAI_API_KEY=your_openai_api_key
ANTHROPIC_API_KEY=your_anthropic_api_key
GOOGLE_AI_API_KEY=your_google_ai_api_key

# Stripe Configuration (optional)
STRIPE_SECRET_KEY=your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key
```

### 3. Database Setup
Apply the database migrations using Supabase CLI or the provided migration files:

```sql
-- Run the migrations in /database/migrations/ in order
-- Or use the Supabase MCP if available
```

### 4. Seed Data
Populate the database with initial data:
- Languages (en, el, es, fr)
- Model domains and configurations
- Tag categories, genres, and tags
- Sample RLS policies

### 5. Run Development Server
```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) to see the application.

## üèó Architecture

### Search Caching Strategy
1. **Hash Generation**: Search parameters are canonically serialized and SHA-256 hashed
2. **Cache Lookup**: Check if hash exists in `searches` table
3. **Generation**: If miss, generate new books using AI and store everything
4. **Consistency**: Same parameters always return same results for all users

### AI Generation Pipeline
1. **Parameter Validation**: Validate language, genre, tags, and model
2. **Prompt Building**: Combine genre prompts, tag boosts, and user query
3. **Structured Generation**: Use Vercel AI SDK with Zod schemas
4. **Content Storage**: Store books, authors, and link to search
5. **Lazy Pages**: Generate individual pages on-demand

### Credit System
- 1 credit ‚âà 1 generated page
- Cache hits are free
- BYO API keys bypass credits
- Stripe integration for credit purchases

## üì± Components

### Key React Components
- `BookGrid` - Displays books with generated gradient covers
- `BrowseFilters` - Language, genre, and tag filtering
- `RandomizeButton` - Discover random books
- `SearchForm` - AI-powered book generation interface

### API Routes
- `POST /api/search` - Create or retrieve cached searches
- `GET /api/search/[id]/page/[p]` - Lazy page generation
- `GET /api/random` - Random book discovery
- `POST /api/stripe/webhook` - Handle credit purchases

## üîí Security

### Row-Level Security Policies
- `profiles` - Users can read/write own profile
- `user_api_keys` - Service-role only access
- `searches`, `bookmarks` - User owns their data
- `books`, `authors` - Public read access
- `user_billing` - Users read own, service-role manages

### Data Protection
- API keys encrypted at rest
- JWT-based authentication via Supabase Auth
- CORS configured for production domains
- Input validation on all endpoints

## üé® UI/UX Features

### Design System
- **Gradient Branding**: Purple to blue gradient theme
- **Glass Morphism**: Backdrop blur effects throughout
- **Responsive Grid**: Adapts from 1 to 4 columns
- **Hover Animations**: Subtle lift and shadow effects
- **Loading States**: Skeleton loaders and spinners

### Accessibility
- Proper semantic HTML structure
- Keyboard navigation support
- Screen reader friendly labels
- High contrast text and backgrounds
- Focus indicators on interactive elements

## üö¢ Deployment

### Vercel Deployment
1. Connect repository to Vercel
2. Configure environment variables
3. Deploy with automatic CI/CD

### Database Migrations
- Use Supabase CLI for schema changes
- Run migrations in staging first
- Backup production before major changes

## üìä Monitoring

### Analytics & Insights
- Track search patterns and popular genres
- Monitor AI generation costs and credits usage
- User engagement metrics (bookmarks, reads)
- Performance monitoring for API response times

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

## üé≠ Disclaimer

All books, authors, and content generated by MirageCodex are entirely fictional and created by AI. Any resemblance to real books or authors is purely coincidental. The platform is designed for entertainment and creative exploration.

---

**MirageCodex** - Where every book is a beautiful impossibility. ‚ú®
